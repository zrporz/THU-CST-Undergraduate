# 第10讲 互联网流量分析与检测

## 背景

### 流量分析技术诞生前夜 P2-9

+ 流量规模激增

+ 流量传播计算机病毒

+ 恶意流量造成经济损失

+ 流量传递隐私

  常见考点：TLS协议

  <img src="C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240605160304598.png" alt="image-20240605160304598" style="zoom:50%;" />

+ 网络通讯匿名化

  用户使用 **Tor (The Onion Router，洋葱路由网络)** 作为匿名通讯设施

  + 源路由：客户端通过洋葱路由算法选择 3 个中继节点（Entry, Middle, Exit）
  + 层次加密：根据选定的三个节点，将消息逐层加密。
  + Entry 解密之后得到 Middle 的地址并转发给 Middle，Entry 虽然知道源地址但是不知道目的地址；Middle 解密得到 Exit 的地址，但不知道消息的来源和目的。
  + 代理访问：Exit 解密得到原始数据包，虽然知道目的，但不知道数据的来源，最后 Exit 代理客户端向网站发起请求。

​		但是 Tor 网络的**层次化加密**应该不足以保证完全的匿名性。

### 核心问题 P10

+ 识别和拦截攻击流量背后的技术是什么？
+ 什么技术在加密和匿名化后仍然可以窃取隐私？

上述技术的核心在于对流量特征进行分析：根据流量的特征推测关联性信息。

### 流量分析定义 P11

定义：对二进制的网络流量进行变换，得到具备语义量化的特征，精确刻画流量的表示（例如流中的包数量、每一个包长度等等）

流量分析技术既可以用于攻击，也可以用于防御

### 流量分析目标 P12-15

+ 推测是否为攻击流量进行入侵检测

  网络入侵检测系统（NIDS, Network Intrusion Detection System）

+ 进行流量分析攻击。E.G. 推测 Tor 网络访问对象的攻击被称为**网站指纹攻击, web fingerprinting**

  流量分析攻击核心原理：虽然明文信息被加密，但信息的载体仍然通过其特征泄漏信息，即信息载体构成侧信道

### 流量分析三要素和分类法 P16

+ 流量分析系统的三要素：流量特征、分析算法、分析目标

## 第1节 负载特征驱动的流量检测

### 基于数据包负载匹配的传统检测方法 P19-24

即传统恶意流量识别方法：基于固定规则 

以 Zeek 为例，现代固定规则检测系统支持的三大类匹配方法包括：

+ 对负载的统计特征进行匹配
+ 对包头字段进行匹配
+ 对明文流量负载进行匹配

### 基于人工智能的流量检测方法总体框架 P25-27

### 基于人工智能的负载分析方法：网站防火墙 P28-36

网站应用防火墙式一种专门用于监控、过滤和阻止传入和传出 Web 应用程序的恶意流量的安全系统

实例：ZeroWall, ODDS, RETSINA

### 基于人工智能的负载分析方法：恶意软件检测 P37-47

实例：WebWitness, Nazca, DYNAMINER, BotSniffer, JACKSTRAWS, HinDom

<img src="C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240605180834801.png" alt="image-20240605180834801" style="zoom:67%;" />

## 第2节 统计特征驱动的流量识别方案

### 基于包粒度特征的检测方法 P48-54

为每一个数据包抽取一个特征向量

实例：Kitsune, nPrintML, CLAP

<img src="C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240605180737911.png" alt="image-20240605180737911" style="zoom: 67%;" />

### 基于流粒度特征的检测方法 P55-67

为每一条流抽取一个特征向量

P57：包粒度特征和流粒度特征的比较

实例：Disclosure, BotFinder, Whisper, Xatu, Lumen

<img src="C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240605181441886.png" alt="image-20240605181441886" style="zoom:67%;" />

### 可编程网络设备上的攻击流量检测 P69-78

+ 可编程网络设备上的流量检测：可编程交换机 P69-75

  就是把机器学习算法实现在可编程交换机上，从而达到更快的速度

  实例：FlowLens, HorusEye,  NetBeacon, 

+ 可编程网络设备上的流量检测：智能网卡 P76-78

  智能网卡（Smart NIC）在网卡芯片组当中集成通用处理器，这样以来不需要进行IO操作消耗CPU资源即可在网卡上完成简单的包处理逻辑

  实例：NIC

### 加密攻击流量检测 P79

现有的方法无法实现通用加密流量检测

简单介绍了基于流量交互图的加密恶意流量识别

## 第3节 检测后的防御方案

### 传统防御手段 P92

+ 路由黑洞
+ IP黑名单
+ 流量清洗中心

### 检测后的防御手段：可编程交换机方案 P95

代表方案：Poseidon, Jaqen, Ripple, 

## 第4节 流量分析攻击

### 网站指纹攻击 P102-105

网站指纹攻击通过分析用户生成的 Tor 流量推测被访问的网站，从而完全破坏 Tor 网络隐藏被访问的网站的功能。

注意：网站指纹攻击采集用户加密流量的位置是用户到 Tor 第一跳的位置，即距离用户最近的节点。即攻击者的位置是在第一跳之前窃听流量。

代表方案：k-fingerprinting, ARES, NetCLR, 

### 网站指纹攻击的变种：流量关联攻击 P106-107

流量分析的目标：判断一个入端口和一个出端口是否为一个用户生成的（这样就可以将 Tor Enter 和 Tor Exit 的信息拼起来）

代表性方案：DeepCoFFA, 

### 其他流量分析攻击 P108-111

+ 针对 APP 应用的方案
+ 针对即时通讯软件应用的方案
+ 针对加密DNS流量的方案

### 流量分析攻击的防御手段 P112-114

+ 基于特征扰动的方案
+ 基于特征消除的方案

![image-20240605234440558](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240605234440558.png)
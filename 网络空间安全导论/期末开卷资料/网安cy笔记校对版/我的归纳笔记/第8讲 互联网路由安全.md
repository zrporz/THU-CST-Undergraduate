# 第8讲 互联网路由安全 总结

![image-20240514201256284](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514201256284.png)

## 第一节 层次化路由体系结构

路由的定义：通过互联的网络，把分组从原地址传输到目的地址。发生在TCP/IP协议的第三层网络层。路由引导分组转送，从源节点出发，经过一系列中间路由器后，到达最终的目的节点。

### 层次化路由

各个路由不是平等的，而是有层次的。

将路由器按区域组织，得到自治系统 autonomous system(AS)，然后再有 intra-AS（同一AS内的路由器运行同一种路由协议） 和 inter-AS 路由协议。

网关路由器：

+ 与边界网关路由器间执行 inter-AS 路由协议
+ 与同一AS内的其它路由器执行 intra-AS 路由协议

### 域内路由

域内路由协议 OSPF: Open Shortest Path First Protocol（分布式的）

![image-20240514202838603](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514202838603.png)

### 域间路由

域间路由协议 BGP

![image-20240514203627066](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514203627066.png)

两种类型的BGP邻居关系：

+ eBGP：不同AS之间建立的BGP关系
+ iBGP：同一AS内部建立的BGP关系

【此处看得粗糙，之后回看】

## 第二节 路由安全问题

### 域内路由安全

针对域内路由的威胁攻击，也主要是针对OSPF协议展开。

OSPF攻击基本原理：攻击者通常假装成合法的域内路由器，伪造多个OSPF协议的**LSA**报文广播出去，迷惑其它路由器路由表的计算。其核心就是如何在伪造LSA的时候，避免出发合法路由器的**fight-back安全机制**（会发送纠正报文）。

#### Periodic injection 攻击

Periodic injection 攻击：

![image-20240514205037766](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514205037766.png)

#### Disguised LSA 攻击

![image-20240514205541245](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514205541245.png)

![image-20240514205643973](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514205643973.png)



### 域间路由安全

#### 路由劫持

![image-20240514210411555](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514210411555.png)

![image-20240514210636025](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514210636025.png)

因为存在路由泄漏问题

#### 路由泄漏

## 第三节 路由源验证

### 路由防劫持

BGP缺乏内建安全机制，没有检查路由是否正确；无法有效抵御恶意攻击（路由劫持/路由泄漏），且无法识别配置错误。

所以如何避免路由劫持/泄漏与配置错误呢？

+ 可靠的IP前缀和自治系统的绑定关系和策略
+ 全球互联网路由选择的稳定性、一致性和安全性
+ 路由过滤（如BOGON）、防止意外或恶意的前缀声明

BOGON 主要指不应出现在公共互联网的码号资源（私有地址、未分配地址、保留地址）

### IRR: Internet Routing Registry

全球路由策略分布式数据库

【粗略地看了一下，没有仔细看】

### RPKI

RPKI 是一种数字证书系统，对码号资源提供密码学可验证担保。

ROA：某个IP地址所有者将IP地址授权给某个AS

![image-20240514212350446](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514212350446.png)

ROA对象：经过加密签名的对象，在RPKI框架中用于声明AS被授权发起的IP前缀。

Max Length：用于指定本次授权可以宣告的最大前缀长度

【粗糙地看了下，之后详细看】

### MANRS Observatory

MANRS Observatory 是一个公共平台，提供路由安全相关信息。

## 第四节 路径验证

**注意，路径验证是和路由源验证相并列的，是两种验证范式。一个是源头，一个是路径。**

![image-20240514213221617](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514213221617.png)

为什么需要路径验证：

场景：当一个用户正在网上冲浪，正常访问各种互联网资源。此时，一名攻击者进行了攻击行动……此时，攻击者伪装自己为正确的源ASN，**绕过路由源验证**。由于其具有更短的AS PATH长度，因此最佳路由将指向恶意攻击者。

### BGPSec

RPKI提供资源分配认证，用于源验证；BGPSec则用于路径验证。

旨在解决域间路由的AS路径篡改问题。

![image-20240514223728652](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514223728652.png)

未部署 BGPSec 与部署了 BGPSec 之间的对比：

![image-20240514224020298](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514224020298.png)

![image-20240514224036424](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514224036424.png)

### FC-BGP

针对 BGPSec 的局限性进行改进：

![image-20240514224257882](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514224257882.png)

FC 指的是 Forward Commitment，具体见下：

![image-20240514224408073](C:\Users\39244\AppData\Roaming\Typora\typora-user-images\image-20240514224408073.png)

见 P133 -142
